package amirz.dngprocessor.device;

import android.util.SparseArray;

import amirz.dngprocessor.params.SensorParams;
import amirz.dngprocessor.parser.TIFFTag;

public class OnePlus6 extends OnePlus {
    @Override
    public boolean isModel(String model) {
        return model.startsWith("ONEPLUS A6");
    }

    @Override
    public void sensorCorrection(SparseArray<TIFFTag> tags, SensorParams sensor) {
        super.sensorCorrection(tags, sensor);
        super.matrixCorrection(tags, sensor);
        if (sensor.gainMap == null) {
            // Extracted from a Camera2 photo
            sensor.gainMap = d2f(
                    3.35083, 3.065918, 2.9196777, 2.6447754, 2.3857422, 2.159912, 1.9973145, 1.9089355, 1.862793, 1.8757324, 1.9594727, 2.11792, 2.3183594, 2.5930176, 2.8432617, 3.0964355, 3.3225098,
                    3.1938477, 2.9189453, 2.6652832, 2.3527832, 2.0725098, 1.8579102, 1.7126465, 1.6079102, 1.5725098, 1.5893555, 1.6689453, 1.8044434, 2.0097656, 2.2749023, 2.5742188, 2.88208, 3.1538086,
                    3.1174316, 2.7956543, 2.4260254, 2.1054688, 1.8183594, 1.6213379, 1.4682617, 1.3845215, 1.359375, 1.3757324, 1.4428711, 1.5666504, 1.7636719, 2.0307617, 2.3300781, 2.7131348, 3.0283203,
                    3.0402832, 2.6313477, 2.2355957, 1.8991699, 1.6210938, 1.4431152, 1.3122559, 1.2382812, 1.2097168, 1.2277832, 1.2897949, 1.3999023, 1.574707, 1.8330078, 2.1523438, 2.522461, 2.9074707,
                    2.9641113, 2.4819336, 2.0827637, 1.7504883, 1.4958496, 1.3222656, 1.2106934, 1.1352539, 1.1015625, 1.1142578, 1.1877441, 1.2929688, 1.4584961, 1.6862793, 1.9992676, 2.3759766, 2.7734375,
                    2.8684082, 2.401123, 2.0090332, 1.6794434, 1.4274902, 1.2609863, 1.1418457, 1.0710449, 1.0339355, 1.0478516, 1.1191406, 1.2387695, 1.3891602, 1.6206055, 1.9057617, 2.30542, 2.7087402,
                    2.8674316, 2.4060059, 1.9855957, 1.6647949, 1.4130859, 1.2487793, 1.1308594, 1.0568848, 1.0146484, 1.0280762, 1.1022949, 1.222168, 1.3786621, 1.6052246, 1.9057617, 2.2717285, 2.715332,
                    2.928711, 2.4382324, 2.0324707, 1.7097168, 1.4475098, 1.2790527, 1.1604004, 1.0891113, 1.0463867, 1.0639648, 1.1350098, 1.2556152, 1.4157715, 1.6433105, 1.9416504, 2.3127441, 2.75708,
                    3.043457, 2.5427246, 2.1455078, 1.8137207, 1.5458984, 1.3605957, 1.2387695, 1.1645508, 1.1298828, 1.151123, 1.21875, 1.329834, 1.496582, 1.7441406, 2.0534668, 2.427246, 2.8884277,
                    3.1669922, 2.7021484, 2.3098145, 1.9765625, 1.6962891, 1.4926758, 1.3581543, 1.2824707, 1.2502441, 1.276123, 1.3339844, 1.449707, 1.642334, 1.8925781, 2.2104492, 2.6079102, 3.0256348,
                    3.2666016, 2.8896484, 2.538086, 2.197754, 1.9125977, 1.7033691, 1.5405273, 1.4621582, 1.4265137, 1.4462891, 1.5180664, 1.6494141, 1.8552246, 2.1079102, 2.4470215, 2.840332, 3.1992188,
                    3.3452148, 3.072998, 2.8205566, 2.49292, 2.1948242, 1.9824219, 1.8144531, 1.7194824, 1.6835938, 1.6945801, 1.7849121, 1.9245605, 2.1357422, 2.4023438, 2.748291, 3.052246, 3.3110352,
                    3.4470215, 3.1801758, 3.088623, 2.828125, 2.5737305, 2.3076172, 2.1748047, 2.0742188, 2.0270996, 2.039795, 2.135254, 2.276123, 2.5024414, 2.758789, 3.0544434, 3.3237305, 3.5888672
            );
            sensor.gainMapSize = new int[] { 17, 13 };
        }
    }

    private static float[] d2f(double... doubles) {
        float[] floats = new float[doubles.length * 4];
        for (int i = 0; i < doubles.length; i++) {
            for (int j = 0; j < 4; j++) {
                floats[i * 4 + j] = (float) doubles[i];
            }
        }
        return floats;
    }
}
